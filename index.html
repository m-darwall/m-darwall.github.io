<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>M Darwall</title>
        <link rel="stylesheet" href="main.css">
    </head>
    <body>
        <div class="circle" id="lang-button" onclick="change_language()">En</div>
        <div id="nodes" class="section">
            <h1 id="welcome">Welcome.</h1>
    	    <canvas class="canvas" id="node-canvas"></canvas>

            <div class="options">
                <h2 id="node-options">Options</h2>
                <label for="node-count"  id="node-num-label">Number of Nodes</label><br>
                <input type="range" min="2" max="1000" value="200" class="slider" id="node-count"><br>
                <label for="connection-count" id="node-conn-label">Number of Connections</label><br>
                <input type="range" min="1" max="20" value="7" class="slider" id="connection-count"><br>
                <label for="node-speed"  id="node-speed-label">Node Speed</label><br>
                <input type="range" min="0" max="100" value="0.8" class="slider" id="node-speed"><br>
                <label for="node-path-straightness"  id="node-path-label">Node Path Straightness</label><br>
                <input type="range" min="0" max="1000" value="967" class="slider" id="node-path-straightness">
            </div>
        </div>
        <div id="flocking" class="section">
            <p id="page-2-message">I hope you're well.</p>
            <canvas class="canvas" id="flock-canvas"></canvas>

        </div>
        <div id="section-3" class="section">
            <p  id="page-3-message">This page is under construction.</p>
        </div>
        <div id="section-4" class="section">
            <p  id="page-4-message">But I hope you enjoy it.</p>
        </div>

    </body>
    <script src="nodes.js"></script>
    <script src="flock.js"></script>
    <script>
        let translations;
        async function fetchTranslations() {
            try {
                const response = await fetch("languages.json5");
                translations = await response.json();
            } catch (error) {
                console.error('Error fetching or parsing data:', error);
            }
        }

        fetchTranslations();
        let languages = ["En", "Cy", "Es", "Nb", "Tp"];
        function change_language(){
            let current_lang = languages.indexOf(document.getElementById("lang-button").textContent);
            current_lang++;
            if(current_lang === languages.length){
                current_lang = 0;
            }
            current_lang = languages[current_lang];
            document.getElementById("lang-button").textContent = current_lang;
            let phrases = translations[current_lang];
            let ids = Object.keys(phrases);
            for(let id_index = 0;id_index<ids.length;id_index++){
                document.getElementById(ids[id_index]).innerHTML = phrases[ids[id_index]];
            }
        }


        // Function to start the animation loop for a canvas
        function startAnimation(check_canvas) {
            // Your animation code here
            if (check_canvas.id==="node-canvas"){
                console.log("start nodes")
                stop_birds();
                start_nodes();
            }else if (check_canvas.id==="flock-canvas"){
                console.log("start birds")
                stop_nodes()
                start_birds()
            }
        }


        // Intersection Observer callback function
        function handleIntersection(entries) {
            entries.forEach(entry => {
                const check_canvas = entry.target;
                if (entry.isIntersecting) {
                    startAnimation(check_canvas);
                }
            });
        }

        // Options for the Intersection Observer
        const options = {
            threshold: 0.5 // Adjust as needed
        };

        // Create an Intersection Observer instance
        const observer = new IntersectionObserver(handleIntersection, options);

        // Target your canvases and observe them
        const canvases = document.querySelectorAll('.canvas');
        canvases.forEach(check_canvas => observer.observe(check_canvas));

    </script>
</html>
